<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세계 지리 마스터 퀴즈</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
            position: relative;
        }
        h1 {
            color: #4CAF50;
            margin-bottom: 20px;
        }
        .quiz-section {
            display: none;
            text-align: left;
        }
        .quiz-section.active {
            display: block;
        }
        .question-box {
            background-color: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .options {
            list-style: none;
            padding: 0;
        }
        .options li {
            background-color: #f0f0f0;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .options li:hover {
            background-color: #ddd;
        }
        .options li.correct {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        .options li.incorrect {
            background-color: #ffcdd2;
            color: #c62828;
        }
        .options li.selected {
            border: 2px solid #4CAF50;
        }
        .feedback {
            margin-top: 10px;
            font-weight: bold;
        }
        .feedback.correct {
            color: #4CAF50;
        }
        .feedback.incorrect {
            color: #d32f2f;
        }
        .explanation {
            margin-top: 15px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
            font-size: 0.9em;
            line-height: 1.5;
            text-align: left;
        }
        .explanation strong {
            color: #1565c0;
        }
        .navigation-buttons {
            margin-top: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #a5d6a7;
            cursor: not-allowed;
        }
        #score-display {
            font-size: 1.2em;
            margin-top: 20px;
        }
        .home-screen, .end-screen, .review-screen {
            text-align: center;
            display: none;
        }
        .home-screen.active, .end-screen.active, .review-screen.active {
            display: block;
        }
        .review-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        .review-list li {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
        }
        .review-list button {
            background-color: #2196F3;
            padding: 8px 16px;
            font-size: 0.9em;
        }
        /* 종료 버튼 스타일 */
        #end-quiz-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            display: none;
        }
        #end-quiz-btn button {
            background-color: #f44336;
        }
        #end-quiz-btn button:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="home-screen" class="screen home-screen active">
            <h1>세계 지리 수행평가 퀴즈</h1>
            <p>원하는 게임 모드를 선택하세요.</p>
            <button onclick="startGame('fact_to_country')">1. 특성 → 국가</button>
            <button onclick="startGame('country_to_fact')">2. 국가 → 특성</button>
            <a href="https://www.seterra.com" target="_blank">국가 맞추기 게임하기</a>
        </div>

        <div id="quiz-screen" class="screen quiz-section">
            <div id="end-quiz-btn">
                <button onclick="endGame()">종료</button>
            </div>
            <p id="progress-info"></p>
            <p id="score-display">점수: 0</p>
            <div class="question-box">
                <p id="question-text"></p>
            </div>
            <ul id="options-list" class="options"></ul>
            <p id="feedback" class="feedback"></p>
            <div id="explanation-box" class="explanation" style="display:none;"></div>
            <div class="navigation-buttons">
                <button id="next-button" onclick="loadNewQuestion()" disabled>다음 문제</button>
                <a href="https://www.seterra.com" target="_blank">국가 맞추기 게임하기</a>
            </div>
        </div>
        
        <div id="end-screen" class="screen end-screen">
            <h1>게임 종료</h1>
            <p id="final-score"></p>
            <button onclick="restartGame()">다시 시작</button>
            <button id="review-button" onclick="showReview()">오답 노트</button>
        </div>

        <div id="review-screen" class="screen review-screen">
            <h1>오답 노트</h1>
            <p>틀렸던 문제들을 다시 풀어보세요.</p>
            <ul id="review-list" class="review-list"></ul>
            <div class="navigation-buttons">
                <button onclick="endGame()">메뉴로 돌아가기</button>
            </div>
            <a href="https://www.seterra.com" target="_blank">국가 맞추기 게임하기</a>
        </div>
    </div>

    <script>
        // CSV 데이터 원본을 JavaScript 배열로 변환
        const geographyData = [
            {"Region":"몬순아시아","Country":"중국","Category":"자연환경","Fact":"서고동저 지형, 주요 하천(창장강·황허강)"},
            {"Region":"몬순아시아","Country":"중국","Category":"산업·경제","Fact":"'세계의 공장', 제철·자동차 세계 1위, 첨단 산업 단지(중관춘, 푸동), 농업(세계 1위 밀·쌀 생산국)"},
            {"Region":"몬순아시아","Country":"중국","Category":"전통 생활","Fact":"가옥(사합원), 의복(치파오), 소수 민족(위구르족·티베트족)"},
            {"Region":"몬순아시아","Country":"중국","Category":"갈등","Fact":"소수민족 분리 독립 갈등, 센카쿠·난사 군도 분쟁"},
            {"Region":"몬순아시아","Country":"미얀마","Category":"특징","Fact":"불교 국가"},
            {"Region":"몬순아시아","Country":"미얀마","Category":"갈등","Fact":"로힝야족(이슬람교)과의 갈등"},
            {"Region":"몬순아시아","Country":"일본","Category":"자연환경","Fact":"환태평양 조산대(지진·화산 활발), 다설 지역(삿포로 눈축제: 세계 3대 축제)"},
            {"Region":"몬순아시아","Country":"일본","Category":"농업","Fact":"벼농사 발달, 전통음식(스시)"},
            {"Region":"몬순아시아","Country":"일본","Category":"산업·경제","Fact":"가공무역 발달, 자동차·전자 산업, 첨단 제조업(로봇, 정밀 기계 등)"},
            {"Region":"몬순아시아","Country":"일본","Category":"사회·문화","Fact":"합장가옥(갓쇼), 전통의복(기모노)"},
            {"Region":"몬순아시아","Country":"일본","Category":"갈등","Fact":"쿠릴열도, 센카쿠열도 분쟁"},
            {"Region":"몬순아시아","Country":"몽골","Category":"자연환경","Fact":"국토의 대부분이 건조 기후"},
            {"Region":"몬순아시아","Country":"몽골","Category":"전통 생활","Fact":"전통 가옥(게르), 유목 생활, 허르헉(양고기 요리)"},
            {"Region":"몬순아시아","Country":"필리핀","Category":"자연환경","Fact":"환태평양 조산대(지진·화산 활발)"},
            {"Region":"몬순아시아","Country":"필리핀","Category":"사회·문화","Fact":"스페인 식민지 영향으로 크리스트교 신자 다수"},
            {"Region":"몬순아시아","Country":"필리핀","Category":"갈등","Fact":"모로족 분리 독립 운동(민다나오섬, 이슬람교)"},
            {"Region":"몬순아시아","Country":"필리핀","Category":"전통 문화","Fact":"전통 의복(바롱) / 전통 음식(아도보, 레촌 등)"},
            {"Region":"몬순아시아","Country":"베트남","Category":"자연환경","Fact":"메콩강 삼각주 곡창 지대, 할롱베이(유네스코 등재, 카르스트 지형)"},
            {"Region":"몬순아시아","Country":"베트남","Category":"농업·자원","Fact":"세계 2위 커피 생산국, 쌀 수출 강국"},
            {"Region":"몬순아시아","Country":"베트남","Category":"산업·경제","Fact":"최근 공업 성장, 외국인 투자 증가"},
            {"Region":"몬순아시아","Country":"베트남","Category":"사회·문화","Fact":"전통 음식(퍼: 쌀국수, 반미), 전통 의복(아오자이)"},
            {"Region":"몬순아시아","Country":"베트남","Category":"갈등","Fact":"남중국해 영유권 갈등"},
            {"Region":"몬순아시아","Country":"타이(태국)","Category":"자연환경","Fact":"짜오프라야강 유역, 메콩강 접경"},
            {"Region":"몬순아시아","Country":"타이(태국)","Category":"농업·자원","Fact":"벼농사 중심, 풍작 기원 문화(송끄란 축제)"},
            {"Region":"몬순아시아","Country":"타이(태국)","Category":"산업·경제","Fact":"관광산업 발달"},
            {"Region":"몬순아시아","Country":"타이(태국)","Category":"사회·문화","Fact":"전통 음식(카오팟, 팟타이, 똠얌꿍), 불교 신자 다수"},
            {"Region":"몬순아시아","Country":"인도네시아","Category":"인구특징","Fact":"세계 인구 4위, 세계 최대 이슬람 인구"},
            {"Region":"몬순아시아","Country":"인도네시아","Category":"자연환경","Fact":"신기 조산대(지진, 화산 활발), 계단식 논 발달"},
            {"Region":"몬순아시아","Country":"인도네시아","Category":"농업·자원","Fact":"세계 커피 3위 생산국, 플랜테이션 농업 발달(팜유, 천연고무)"},
            {"Region":"몬순아시아","Country":"인도네시아","Category":"산업·경제","Fact":"천연가스·석유, 석탄 수출, 노동집약적 공업 발달"},
            {"Region":"몬순아시아","Country":"인도네시아","Category":"사회·문화","Fact":"전통 음식(나시고렝), 전통 가옥(루마 아닷: 고상가옥), 동남아시아 국가 연합(ASEAN)의 본부 위치"},
            {"Region":"몬순아시아","Country":"인도","Category":"자연환경","Fact":"히말라야 산맥, 데칸고원, 갠지스강 유역 충적평야(벼농사)"},
            {"Region":"몬순아시아","Country":"인도","Category":"농업","Fact":"여름 몬순으로 벼농사 발달, 데칸고원(목화), 북동부(다르질링 지역 차 생산)"},
            {"Region":"몬순아시아","Country":"인도","Category":"산업·경제","Fact":"뭄바이(영화산업: 발리우드), 첨단 산업(뱅갈루루 '인도의 실리콘밸리')"},
            {"Region":"몬순아시아","Country":"인도","Category":"사회·문화","Fact":"힌두교 중심, 전통의복(사리와 도티)"},
            {"Region":"몬순아시아","Country":"인도","Category":"갈등","Fact":"카슈미르 분쟁(vs 파키스탄)"},
            {"Region":"몬순아시아","Country":"네팔","Category":"특징","Fact":"인도와 함께 힌두교 국가"},
            {"Region":"몬순아시아","Country":"파키스탄","Category":"특징","Fact":"이슬람 국가, 세계 인구 수 5위"},
            {"Region":"몬순아시아","Country":"방글라데시","Category":"특징","Fact":"이슬람 국가, 갠지스 강 하류에 위치"},
            {"Region":"몬순아시아","Country":"스리랑카","Category":"자연환경","Fact":"인도양 섬나라, 차 플랜테이션(실론 차)"},
            {"Region":"몬순아시아","Country":"스리랑카","Category":"갈등","Fact":"신할리즈족(불교) vs 타밀족(힌두교)"},
            {"Region":"오세아니아","Country":"오스트레일리아","Category":"자원","Fact":"자원 부국, 석탄·철광석·보크사이트 등이 풍부하여 광업 발달"},
            {"Region":"오세아니아","Country":"오스트레일리아","Category":"농업","Fact":"기업적 농목업(찬정) → 양모, 유제품, 소고기 수출"},
            {"Region":"오세아니아","Country":"오스트레일리아","Category":"원주민","Fact":"애버리지니와 유럽계 갈등"},
            {"Region":"몬순아시아","Country":"말레이시아","Category":"자연환경","Fact":"말라카 해협 국제 해상 요충지"},
            {"Region":"몬순아시아","Country":"말레이시아","Category":"산업·경제","Fact":"석유 및 천연가스, 주석, 팜유 등 수출"},
            {"Region":"몬순아시아","Country":"말레이시아","Category":"사회·문화","Fact":"이슬람교 비율이 가장 높음. 그 다음 불교"},
            {"Region":"몬순아시아","Country":"싱가포르","Category":"특징","Fact":"1인당 GDP 아시아 1위, 도시 국가, 교통·무역 요충지(인도양과 태평양 사이)"},
            {"Region":"오세아니아","Country":"뉴질랜드","Category":"자연환경","Fact":"북섬(주로 화산지형), 남섬(빙하 지형), 국토 전체가 서안해양성 기후"},
            {"Region":"오세아니아","Country":"뉴질랜드","Category":"갈등","Fact":"마오리족과 유럽계 갈등 발생, 공존 노력(마오리어 공용어 지정)"},
            {"Region":"건조아시아와 북부아프리카","Country":"튀르키예","Category":"자연환경","Fact":"아나톨리아 고원(신기 조산대), 파묵칼레(카르스트 지형)"},
            {"Region":"건조아시아와 북부아프리카","Country":"튀르키예","Category":"산업·경제","Fact":"2차 산업 내 제조업 생산액 비율이 상대적으로 높음"},
            {"Region":"건조아시아와 북부아프리카","Country":"튀르키예","Category":"갈등","Fact":"티그리스·유프라테스 강 상류 댐 건설로 수자원 갈등"},
            {"Region":"건조아시아와 북부아프리카","Country":"이집트","Category":"인구","Fact":"건조 아시아 및 북부 아프리카에서 인구 가장 많음"},
            {"Region":"건조아시아와 북부아프리카","Country":"이집트","Category":"자연환경","Fact":"나일강 하구 삼각주, 수에즈 운하"},
            {"Region":"건조아시아와 북부아프리카","Country":"이집트","Category":"기후","Fact":"국토 전체가 사막 기후, 오아시스·관개 농업(대추야자·밀)"},
            {"Region":"건조아시아와 북부아프리카","Country":"이집트","Category":"산업·경제","Fact":"관광 산업, 교통(수에즈 운하: 홍해와 지중해 연결)"},
            {"Region":"건조아시아와 북부아프리카","Country":"이집트","Category":"갈등","Fact":"국제·외래 하천인 나일강(상류에 위치한 에티오피아, 수단과 수자원 갈등)"},
            {"Region":"건조아시아와 북부아프리카","Country":"이란","Category":"인구","Fact":"건조 아시아 및 북부 아프리카에서 인구 2위"},
            {"Region":"건조아시아와 북부아프리카","Country":"이란","Category":"자연환경","Fact":"이란 고원(신기 조산대), 바드기르(환풍구), 카나트(지하 관개 시설)"},
            {"Region":"건조아시아와 북부아프리카","Country":"이란","Category":"농업·자원","Fact":"건조 기후, 밀·목화 재배"},
            {"Region":"건조아시아와 북부아프리카","Country":"이란","Category":"산업·경제","Fact":"석유·천연가스 자원 풍부(페르시아 만)"},
            {"Region":"건조아시아와 북부아프리카","Country":"이란","Category":"전통 음식","Fact":"케밥, 압구시트 등"},
            {"Region":"건조아시아와 북부아프리카","Country":"이란","Category":"종교","Fact":"이라크와 더불어 이슬람교 중 시아파 비중이 높음"},
            {"Region":"건조아시아와 북부아프리카","Country":"수단","Category":"자연환경","Fact":"사헬 지대, 사막화 피해"},
            {"Region":"건조아시아와 북부아프리카","Country":"수단","Category":"갈등","Fact":"다르푸르 분쟁, 남수단 분리(2011)"},
            {"Region":"건조아시아와 북부아프리카","Country":"시리아","Category":"특징","Fact":"난민이 가장 많이 발생하는 국가"},
            {"Region":"건조아시아와 북부아프리카","Country":"모로코","Category":"자연환경","Fact":"아틀라스산맥(신기조산대), 지중해 인근 지역은 지중해성 기후"},
            {"Region":"건조아시아와 북부아프리카","Country":"모로코","Category":"인구 이동","Fact":"프랑스로 인구 이동(경제적 요인)이 많은 북부 아프리카 3인방 중 하나"},
            {"Region":"건조아시아와 북부아프리카","Country":"사우디아라비아","Category":"산업·경제","Fact":"세계 최대 산유국, '비전 2030' 신도시(네옴), 대추야자 재배"},
            {"Region":"건조아시아와 북부아프리카","Country":"사우디아라비아","Category":"사회·문화","Fact":"이슬람 성지 메카·메디나"},
            {"Region":"건조아시아와 북부아프리카","Country":"사우디아라비아","Category":"국제관계","Fact":"걸프 협력 회의(GCC) 회원국"},
            {"Region":"건조아시아와 북부아프리카","Country":"사우디아라비아","Category":"자연환경","Fact":"사막 기후, 두바이 아부다비 도시 발달"},
            {"Region":"건조아시아와 북부아프리카","Country":"리비아","Category":"자연환경","Fact":"사하라 사막"},
            {"Region":"건조아시아와 북부아프리카","Country":"리비아","Category":"산업·경제","Fact":"석유 자원 풍부"},
            {"Region":"건조아시아와 북부아프리카","Country":"아랍에미리트","Category":"산업·경제","Fact":"석유·천연가스"},
            {"Region":"건조아시아와 북부아프리카","Country":"아랍에미리트","Category":"사회·문화","Fact":"외국인 노동자 대규모 유입(청장년층에서 남초 현상 발생)"},
            {"Region":"건조아시아와 북부아프리카","Country":"아랍에미리트","Category":"국제관계","Fact":"걸프 협력 회의(GCC) 회원국"},
            {"Region":"건조아시아와 북부아프리카","Country":"카타르","Category":"산업·경제","Fact":"천연가스 대국, 고소득국"},
            {"Region":"건조아시아와 북부아프리카","Country":"카타르","Category":"사회·문화","Fact":"2022년 FIFA 월드컵 개최(겨울 개최)"},
            {"Region":"건조아시아와 북부아프리카","Country":"카타르","Category":"국제관계","Fact":"걸프 협력 회의(GCC) 회원국"},
            {"Region":"건조아시아와 북부아프리카","Country":"카자흐스탄","Category":"자연환경","Fact":"초원·스텝 기후, 아랄해 연안(사막화 문제)"},
            {"Region":"건조아시아와 북부아프리카","Country":"카자흐스탄","Category":"농업·자원","Fact":"유목, 석유·천연가스 생산(카스피해)"},
            {"Region":"건조아시아와 북부아프리카","Country":"카자흐스탄","Category":"전통가옥","Fact":"유르트(게르와 비슷)"},
            {"Region":"건조아시아와 북부아프리카","Country":"말리, 니제르, 에티오피아","Category":"특징","Fact":"사헬 지대(사막화 문제 심각)"},
            {"Region":"건조아시아와 북부아프리카","Country":"우즈베키스탄","Category":"특징","Fact":"아랄해 연안: 사막화 문제"},
            {"Region":"건조아시아와 북부아프리카","Country":"이스라엘","Category":"특징","Fact":"크리스트교·유대교·이슬람교 성지 공존"},
            {"Region":"유럽과 북부 아메리카","Country":"영국","Category":"역사","Fact":"산업혁명 발상지"},
            {"Region":"유럽과 북부 아메리카","Country":"영국","Category":"자연환경","Fact":"서안해양성 기후, 혼합농업, 목축업 및 낙농업 발달"},
            {"Region":"유럽과 북부 아메리카","Country":"영국","Category":"산업지역","Fact":"요크셔·랭커셔(전통 공업 지역, 쇠퇴), 뉴캐슬·미들즈브러(임해 공업), 케임브리지 사이언스 파크(첨단 산업)"},
            {"Region":"유럽과 북부 아메리카","Country":"영국","Category":"도시","Fact":"런던(최상위 계층 세계도시)"},
            {"Region":"유럽과 북부 아메리카","Country":"영국","Category":"갈등","Fact":"스코틀랜드 분리 독립 요구, 브렉시트(EU 탈퇴)"},
            {"Region":"유럽과 북부 아메리카","Country":"미국","Category":"전통 공업","Fact":"러스트 벨트 - 뉴잉글랜드(경공업), 중부 대서양 연안(기계·제철), 오대호 연안(자동차·제철)"},
            {"Region":"유럽과 북부 아메리카","Country":"미국","Category":"신흥 공업","Fact":"선벨트 - 멕시코만 연안 공업 지역, 태평양 연안 공업 지역"},
            {"Region":"유럽과 북부 아메리카","Country":"미국","Category":"주요 도시","Fact":"뉴욕(UN 본부, 최상위 계층 세계도시), 시카고(철도·수운 교통, 고층 스카이라인), 디트로이트(자동차 산업 쇠퇴), 휴스턴(석유 화학·우주항공), 로스앤젤레스(할리우드 영화), 시애틀(보잉 항공기, 스타벅스 본사)"},
            {"Region":"유럽과 북부 아메리카","Country":"프랑스","Category":"산업지역","Fact":"로렌(철강 공업, 쇠퇴), 르아브르·됭케르크(임해 공업), 소피아 앙티폴리스(첨단 산업)"},
            {"Region":"유럽과 북부 아메리카","Country":"프랑스","Category":"도시","Fact":"파리: 라데팡스 업무지구"},
            {"Region":"유럽과 북부 아메리카","Country":"멕시코","Category":"산업·경제","Fact":"마킬라도라(미국 국경지대 조립가공업, NAFTA 이후 성장)"},
            {"Region":"유럽과 북부 아메리카","Country":"독일","Category":"산업지역","Fact":"루르·자르·작센(전통 공업, 쇠퇴·재생 노력), 라인·쉬네(임해 공업 지역), 라인강"},
            {"Region":"유럽과 북부 아메리카","Country":"캐나다","Category":"사회·문화","Fact":"퀘벡주 프랑스어 사용, 분리 독립 요구"},
            {"Region":"유럽과 북부 아메리카","Country":"캐나다","Category":"경제","Fact":"USMCA(미·멕·캐 협정) 참여, 자원 부국"},
            {"Region":"유럽과 북부 아메리카","Country":"이탈리아","Category":"산업","Fact":"제3 이탈리아(섬유·의류·가죽, 중소기업 협동조합), 남북 경제 격차 큼"},
            {"Region":"유럽과 북부 아메리카","Country":"이탈리아","Category":"갈등","Fact":"파다니아(이탈리아 북부) 분리 독립 운동"},
            {"Region":"유럽과 북부 아메리카","Country":"스페인(에스파냐)","Category":"산업","Fact":"빌바오 철강 산업(전통 공업, 쇠퇴)"},
            {"Region":"유럽과 북부 아메리카","Country":"스페인(에스파냐)","Category":"갈등","Fact":"카탈루냐 분리 독립(바르셀로나 중심), 바스크 분리 운동"},
            {"Region":"유럽과 북부 아메리카","Country":"네덜란드","Category":"산업","Fact":"로테르담(라인강 하구, 세계적 무역항, 석유화학 클러스터)"},
            {"Region":"유럽과 북부 아메리카","Country":"네덜란드","Category":"갈등","Fact":"북부 플랑드르(네덜란드어, 경제적 수준↑) vs 남부 왈로니아(프랑스어)"},
            {"Region":"유럽과 북부 아메리카","Country":"벨기에","Category":"특징","Fact":"EU 본부(브뤼셀) 소재"},
            {"Region":"유럽과 북부 아메리카","Country":"스웨덴","Category":"특징","Fact":"시스타 사이언스 시티(스톡홀름, ICT 중심 첨단 산업 클러스터)"},
            {"Region":"유럽과 북부 아메리카","Country":"핀란드","Category":"특징","Fact":"오울루(과거 제지·연어 무역항 ICT 클러스터, 노키아 중심, 산학 협력)"},
            {"Region":"유럽과 북부 아메리카","Country":"스위스","Category":"특징","Fact":"EU 비회원국, 그러나 솅겐 협정 가입으로 자유 이동 가능"}
        ];

               let score = 0;
        let questionCount = 0;
        let currentQuestionData = {};
        let currentMode = '';
        let wrongAnswers = [];
        let isReviewMode = false;
        let reviewIndex = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function getFactToCountryQuestion() {
            const entry = geographyData[Math.floor(Math.random() * geographyData.length)];
            const correctCountry = entry.Country;
            const allCountries = [...new Set(geographyData.map(item => item.Country))].filter(c => c !== correctCountry);
            
            shuffleArray(allCountries);
            const incorrectCountries = allCountries.slice(0, 3);
            
            const options = [correctCountry, ...incorrectCountries];
            shuffleArray(options);

            return {
                type: 'fact_to_country',
                questionText: `다음 설명에 해당하는 나라는 어디일까요?<br>- ${entry.Fact}`,
                correctAnswer: correctCountry,
                options: options,
                explanation: `<strong>${entry.Country}</strong>에 대한 정보입니다.<br>위치: ${entry.Region}<br>분류: ${entry.Category}<br>설명: ${entry.Fact}`
            };
        }

        function getCountryToFactQuestion() {
            const correctCountry = geographyData[Math.floor(Math.random() * geographyData.length)].Country;
            const factsForCountry = geographyData.filter(item => item.Country === correctCountry);
            const correctFactEntry = factsForCountry[Math.floor(Math.random() * factsForCountry.length)];
            const correctFact = correctFactEntry.Fact;
            
            const otherFacts = geographyData.filter(item => item.Country !== correctCountry).map(item => item.Fact);
            shuffleArray(otherFacts);
            const incorrectFacts = otherFacts.slice(0, 3);
            
            const options = [correctFact, ...incorrectFacts];
            shuffleArray(options);

            return {
                type: 'country_to_fact',
                questionText: `다음 설명 중 '${correctCountry}'에 대한 설명은 무엇일까요?`,
                correctAnswer: correctFact,
                options: options,
                explanation: `<strong>${correctCountry}</strong>에 대한 정보입니다.<br>위치: ${correctFactEntry.Region}<br>분류: ${correctFactEntry.Category}<br>설명: ${correctFactEntry.Fact}`
            };
        }

        function loadNewQuestion() {
            const nextButton = document.getElementById('next-button');
            const explanationBox = document.getElementById('explanation-box');
            
            nextButton.disabled = true;
            explanationBox.style.display = 'none';

            if (isReviewMode) {
                if (reviewIndex >= wrongAnswers.length) {
                    alert('오답 문제를 모두 풀었습니다!');
                    endGame();
                    return;
                }
                currentQuestionData = wrongAnswers[reviewIndex];
                reviewIndex++;
                document.getElementById('progress-info').textContent = `오답 문제 (${reviewIndex}/${wrongAnswers.length})`;
            } else {
                if (currentMode === 'fact_to_country') {
                    currentQuestionData = getFactToCountryQuestion();
                } else {
                    currentQuestionData = getCountryToFactQuestion();
                }
                questionCount++;
                document.getElementById('progress-info').textContent = `문제 ${questionCount}번째`;
            }

            document.getElementById('feedback').textContent = '';
            document.getElementById('question-text').innerHTML = currentQuestionData.questionText;
            
            const optionsList = document.getElementById('options-list');
            optionsList.innerHTML = '';
            currentQuestionData.options.forEach(option => {
                const li = document.createElement('li');
                li.textContent = option;
                li.onclick = () => checkAnswer(li, option);
                optionsList.appendChild(li);
            });
        }

        function checkAnswer(selectedLi, selectedOption) {
            const options = document.getElementById('options-list').children;
            const feedback = document.getElementById('feedback');
            const explanationBox = document.getElementById('explanation-box');
            const nextButton = document.getElementById('next-button');
            
            if (selectedLi.classList.contains('selected')) return;

            Array.from(options).forEach(li => {
                li.classList.add('selected');
                if (li.textContent === currentQuestionData.correctAnswer) {
                    li.classList.add('correct');
                } else if (li === selectedLi) {
                    li.classList.add('incorrect');
                }
                li.onclick = null;
            });

            if (selectedOption === currentQuestionData.correctAnswer) {
                feedback.textContent = '✅ 정답입니다!';
                feedback.classList.remove('incorrect');
                feedback.classList.add('correct');
                if (!isReviewMode) {
                    score++;
                }
            } else {
                feedback.textContent = `❌ 틀렸습니다. 정답은 '${currentQuestionData.correctAnswer}'입니다.`;
                feedback.classList.remove('correct');
                feedback.classList.add('incorrect');
                if (!isReviewMode) {
                    wrongAnswers.push(JSON.parse(JSON.stringify(currentQuestionData)));
                }
            }
            
            explanationBox.innerHTML = currentQuestionData.explanation;
            explanationBox.style.display = 'block';

            if (!isReviewMode) {
                document.getElementById('score-display').textContent = `점수: ${score}`;
            }
            nextButton.disabled = false;
        }

        function startGame(mode) {
            currentMode = mode;
            score = 0;
            questionCount = 0;
            wrongAnswers = [];
            isReviewMode = false;
            document.getElementById('home-screen').classList.remove('active');
            document.getElementById('quiz-screen').classList.add('active');
            document.getElementById('end-quiz-btn').style.display = 'block';
            document.getElementById('score-display').textContent = `점수: 0`;
            loadNewQuestion();
        }
        
        function endGame() {
            document.getElementById('quiz-screen').classList.remove('active');
            document.getElementById('review-screen').classList.remove('active');
            document.getElementById('end-screen').classList.add('active');
            document.getElementById('end-quiz-btn').style.display = 'none';
            if (isReviewMode) {
                document.getElementById('final-score').textContent = `오답 문제를 모두 풀었습니다!`;
            } else {
                document.getElementById('final-score').textContent = `총 ${questionCount}문제 중 ${score}문제를 맞히셨습니다.`;
            }
            if (wrongAnswers.length > 0) {
                document.getElementById('review-button').style.display = 'block';
            } else {
                document.getElementById('review-button').style.display = 'none';
            }
        }

        function restartGame() {
            document.getElementById('end-screen').classList.remove('active');
            document.getElementById('home-screen').classList.add('active');
        }

        function showReview() {
            isReviewMode = true;
            reviewIndex = 0;
            document.getElementById('end-screen').classList.remove('active');
            document.getElementById('quiz-screen').classList.add('active');
            document.getElementById('score-display').textContent = `오답 노트`;
            document.getElementById('next-button').textContent = '다음 오답 문제';
            document.getElementById('end-quiz-btn').style.display = 'block';
            loadNewQuestion();
        }
    </script>
</body>
</html>






